# LikeLion 8th Coding Session

## ìì†Œì„¤ ë‹·ì»´ ë§Œë“¤ê¸°

HTML, CSS, Python ê¸°ì´ˆ ì„ í–‰ í•„ìš” <br/>

- render
  - django.shortcut [render](https://github.com/django/django/blob/master/django/shortcuts.py
  - í•¨ìˆ˜ë¥¼ ëˆŒëŸ¬ì„œ ë³¼ ìˆ˜ ìˆìŒ
  
## Model & Database

- ê¸°ë³¸ì ìœ¼ë¡œ í´ë˜ìŠ¤ë¡œ êµ¬í˜„
- ê° object = instance
- ëª¨ë¸ì„ Databaseì— ë°˜ì˜í•˜ê¸°
  - ``python manage.py makemigrations``
    - DBê°€ ì•Œì•„ë“¤ì„ ìˆ˜ ìˆëŠ” ë²ˆì—­ íŒŒì¼ì„ ìƒì„±
  - ``python manage.py migrate``
    - DBì— ìƒì„±ëœ íŒŒì¼ì²˜ëŸ¼ ë°˜ì˜í•´ë‹¬ë¼ê³  ìš”ì²­

- ê°•ì˜ ì§„í–‰
  - ê°€ìƒí™˜ê²½ ìƒì„± í›„ ì‹¤í–‰
  - djangoì„¤ì¹˜
  - í”„ë¡œì íŠ¸ ìƒì„±
  - ``python manage.py migrate``
    - ê¸°ë³¸ db sqlite3ë¡œ ì—°ë™
      - settings.py 76line DATABASESì— ê¸°ë³¸ DB ì„¤ì •ë˜ì–´ìˆìŒ
    - admin, auth, session ë“± ê¸°ë³¸ì œê³µ app ì ìš©
  - main app ìƒì„±
  - models.pyì— ëª¨ë¸ ìƒì„±
    - models.Model ìƒì†í•¨
      ```python
      class Jasoseol(models.Model):
        title = models.CharField(max_length=50)
        content = models.TextField()
        updated_at = models.DateTimeField(auto_now=True)
      ```
    - Primary Key : AutoField
    - ë¬¸ìì—´ : CharField, TextField, SlugField
    - ìˆ«ì : IntegerField, PositiveIntegerField, FloatField
    - ë‚ ì§œ/ì‹œê°„ : DateField, TimeField, DateTimeField
    - ì°¸/ê±°ì§“ : BooleanField, NullBooleanField
    - íŒŒì¼ : FileField, ImageField, FilePathField
  - ``python manage.py makemigrations`` -model ê´€ë ¨ ë³€ê²½ì´ ìƒê²¼ì„ ë•Œ
  - ``python manage.py migrate``
  - admin ì‚¬ìš©
    - ``python manage.py runserver``
    - ìƒˆë¡œìš´ í„°ë¯¸ë„
      - ``python manage.py createsuperuser``
    - ~/adminì— ë¡œê·¸ì¸
  - admin.pyì—ì„œ adminí˜ì´ì§€ì— model ë“±ë¡
    ```python
    from django.contrib import admin
    from .models import Jasoseol

    admin.site.register(Jasoseol)
    ```
  - admin ì°½ì—ì„œ ë°ì´í„° ì¶”ê°€ 
  
## ModelForm

- ModelForm
  - ëª¨ë¸ì— ëŒ€ì‘í•˜ëŠ” htmlí¼ì„ ë§Œë“¤ì–´ ì¤Œ
  - ë°ì´í„°ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ê°€ ê°„í¸
  - í¼ì„ ë‹¤ë£¨ëŠ” ë²•ì„ ë°°ì›Œì•¼ í•œë‹¤.
  
- ê°•ì˜ ì§„í–‰
  - main ì•±ì—ì„œ templates í´ë”ì—ì„œ
    - index.html ìƒì„± í›„ !+enter
  - views.pyì—ì„œ index ë·° ìƒì„±
  - urls.pyì—ì„œ urlì—°ê²°
  - main ì•±ì—ì„œ static í´ë”ì—ì„œ css í´ë”ì—ì„œ
    - index.css ìƒì„± ë° ê°„ë‹¨í•œ ìŠ¤íƒ€ì¼ ì ìš©
  - index.htmlì—ì„œ ``{% loadstatic %}``ë“± cssì—°ê²°
  - create view ìƒì„±
    - url
    - views
    - htmlì— ì—°ê²°
  - main ì•±ì— forms.py ìƒì„±
    - ì–´ë–¤ ëª¨ë¸ê³¼ ëŒ€ì‘ë˜ëŠ” htmlí¼ì„ ë§Œë“¤ì–´ì¤Œ
    - Metaì— í•´ë‹¹ ì •ë³´ ì„ íƒ
      ```python
      from django import forms
      from .models import Jasoseol

      class JssForm(forms.ModelForm):

          class Meta:
              model = Jasoseol
              fields = ('title', 'content',)
      ```
    - views.py
      ```python
      def index(request):
          all_jss = Jasoseol.objects.all()
          return render(request, 'index.html', {'all_jss':all_jss})
          
      def create(request):
          if request.method == "POST":
              filled_form = JssForm(request.POST)
              if filled_form.is_valid():
                  filled_form.save()
                  return redirect('index')
          jss_form = JssForm()
          return render(request, 'create.html', {'jss_form':jss_form})
      ```
    - create.html
      ```html
      <form method="POST" action="">
          {% csrf_token %}
          {{jss_form.as_p}}
          <input type="submit" value="í™•ì¸">
      </form>
      ```
    - index.html
      ```html
      {% for jss in all_jss %}
          <a href="{% url 'detail' jss.id %}">
              <div class="all_jss">
                  <p>{{jss.title}}</p>
                  <p>{{jss.content}}</p>
                  <p>{{jss.updated_at|date:"Y-m-d"}}</p>
              </div>
          </a>
      {% endfor %}
      ```
    - settings.py
      ```python
      LANGUAGE_CODE = 'ko-kr'
      TIME_ZONE = 'Asia/Seoul'
      ```
    - django template filter [link](https://docs.djangoproject.com/en/3.1/ref/templates/builtins/)
    - modelform ì»¤ìŠ¤í…€
      ```python
      class JssForm(forms.ModelForm):

          class Meta:
              model = Jasoseol
              fields = ('title', 'content',)

          def __init__(self, *args, **kwargs):
              super().__init__(*args, **kwargs)
              self.fields['title'].label = "ì œëª©"
              self.fields['content'].label = "ìê¸°ì†Œê°œì„œ ë‚´ìš©"
              self.fields['title'].widget.attrs.update({
                  'class': 'jss_title',
                  'placeholder': 'ì œëª©',
              })
      ```
## Primary Key

- PK
  - ì˜¤ë¸Œì íŠ¸ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ê°’
  - ì¤‘ë³µë  ìˆ˜ ì—†ëŠ” ë‹¨ì¼ ê°’
  
- ê°•ì˜ ì§„í–‰
  - pkì„¤ì •í•˜ì§€ì•Šìœ¼ë©´ id í•„ë“œê°€ ë§Œë“¤ì–´ì§
  - ì„œë²„ ì¼œê³  ë©”ì¸ í˜ì´ì§€ì—ì„œ id ì¶œë ¥í•´ë³´ê¸°
  - primary_key=True íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ë©´ PKê°€ ë¨
  - views.pyì— detail ìƒì„±
    - detail.html ìƒì„±, url ë“±ë¡
    ```python
    def detail(request, jss_id):
        # my_jss = Jasoseol.objects.get(pk=jss_id)
        my_jss = get_object_or_404(Jasoseol, pk=jss_id)
        return render(request, 'detail.html', {'my_jss':my_jss})
    ```
  - delete ìƒì„±, url ì—°ê²° delete view ìƒì„±
    ```python
    def delete(request, jss_id):
        my_jss = Jasoseol.objects.get(pk=jss_id)
        my_jss.delete()
        return redirect('index')
    ```
  - update ìƒì„±, url ì—°ê²° update view ìƒì„±
    ```python
    def update(request, jss_id):
        my_jss = Jasoseol.objects.get(pk=jss_id)
        jss_form = JssForm(instance=my_jss)
        if request.method == "POST":
            updated_form = JssForm(request.POST, instance=my_jss) #ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë„£ì–´ì•¼ ìˆ˜ì •
            if updated_form.is_valid():
                updated_form.save()
                return redirect('index')

        return render(request, 'create.html', {'jss_form':jss_form})
    ```
## User

- ê°•ì˜ ì§„í–‰
  - accountsì•± ìƒì„±
  - ê° ì•± ë³„ url ë¶„ë¦¬ ë° ì—°ê²°
  - django [User](https://github.com/django/django/blob/master/django/contrib/auth/models.py#L389)
  - íšŒì›ê°€ì…ì„ ìœ„í•œ view ìƒì„±
    - accountsì•±ì˜ views.py
    ```python
    from django.shortcuts import render, redirect
    from django.contrib.auth.forms import UserCreationForm
    
    def signup(request):
        regi_form = UserCreationForm()
        if request.method == "POST":
            filled_form = UserCreationForm(request.POST)
            if filled_form.is_valid():
                filled_form.save()
                return redirect('index')

        return render(request, 'signup.html', {'regi_form':regi_form})
    ```
    - signup.html
    ```html
    <form method="POST" action="">
    {% csrf_token %}
    {{regi_form.as_p}}
    <input type="submit" value="íšŒì›ê°€ì…">
    </form>
    ```
  - ë¡œê·¸ì¸ [ë·°](https://github.com/django/django/blob/master/django/contrib/auth/views.py#L40), ë¡œê·¸ì•„ì›ƒ êµ¬í˜„
  - urls.py
  ```python
  from django.contrib.auth.views import LoginView, LogoutView

  urlpatterns = [
      path('signup/', signup, name='signup'),
      path('login/', LoginView.as_view(), name='login'),
      path('logout/', LogoutView.as_view(), name='logout'),
  ]
  ```
  - registration/login.html ìƒì„± ``{{form}}``
  - settings.pyì— ``LOGIN_REDIRECT_URL='/'`` ì¶”ê°€ [success](https://github.com/django/django/blob/master/django/contrib/auth/views.py#L65)
  - ë¡œê·¸ì¸ì´ ë˜ì–´ìˆìœ¼ë©´ ì–´ëŠ ê³³ì´ë“  ``{{user}}``ì„ í†µí•´ ì¡°íšŒ ê°€ëŠ¥
  - settings.pyì— ``LOGOUT_REDIRECT_URL='/'`` ì¶”ê°€
  - ë¡œê·¸ì•„ì›ƒí•˜ë©´ AnonymousUserê°€ ``{{user}}``ì— ë“¤ì–´ê°
  - í…œí”Œë¦¿íƒœê·¸ {% if %}ë¥¼ ì‚¬ìš©í•˜ì—¬ íƒœê·¸ ì¡°ê±´ë¶€ ê°€ì‹œí™” ê°€ëŠ¥
  - LoginViewë¥¼ ìƒì† ë° ì¬ì •ì˜ ì‚¬ìš©
    ```python
    class MyLoginView(LoginView):
        template_name = 'login.html'
    ```
    
## Foreign Key

- Foreign Key
  - ì™¸ë˜í‚¤
- Permission
- Decorator
- filter

- ê°•ì˜ ì§„í–‰
  - main.models.py
    ```python
    class Jasoseol(models.Model):
        title = models.CharField(max_length=50)
        content = models.TextField()
        updated_at = models.DateTimeField(auto_now=True)
        author = models.ForeignKey(User, on_delete=models.CASCADE)
        #CASCADEì—°ê²°ëœ ì˜¤ë¸Œì íŠ¸(User)ê°€ ì§€ì›Œì§ˆ ë•Œ ìì†Œì„¤ ì˜¤ë¸Œì íŠ¸ë„ ì§€ì›Œì§
    ```
  - defaultê°’ìœ¼ë¡œ ì–´ë–¤ ìœ ì € ì‚½ì… or ``null=True``
  - ``python manage.py makemigrations``
    - option 2 ì„ íƒ
  - ``python manage.py migrate``
  - create ìˆ˜ì •
    ```python
    def create(request):
        if request.method == "POST":
            filled_form = JssForm(request.POST)
            if filled_form.is_valid():
                temp_form = filled_form.save(commit=False)#dbì ìš© ì—°ê¸°
                temp_form.author = request.user
                temp_form.save()
                return redirect('index')
        jss_form = JssForm()
        return render(request, 'create.html', {'jss_form':jss_form})
    ```
  - ìì‹ ì˜ ê¸€ë§Œ ì‚­ì œ ê°€ëŠ¥
    ```python
    def delete(request, jss_id):
        my_jss = Jasoseol.objects.get(pk=jss_id)
        if request.user == my_jss.author:
            my_jss.delete()
            return redirect('index')

        raise PermissionDenied
    ```
  - decorator ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê³³ì— ì‚¬ìš© ``@login_required(login_url='/login/')``
  - ë‚´ê°€ ì‘ì„±í•œ ìì†Œì„œë§Œ ë³´ê¸°
    - queryset filter [ì‚¬ìš©](https://docs.djangoproject.com/en/3.1/ref/models/querysets/#filter)
      ```python
      def my_index(request):
          my_jss = Jasoseol.objects.filter(author=request.user)
          return render(request, 'index.html', {'all_jss':my_jss})
      ```
  
## ëŒ“ê¸€ ë§Œë“¤ê¸°
- ì‹¤ìŠµ ì§„í–‰
  - ëŒ“ê¸€ ìƒì„±
    - model ìƒì„±
      ```python
      class Comment(models.Model):
          content = models.CharField(max_length=100)
          author = models.ForeignKey(User, on_delete=models.CASCADE)
          jasoseol = models.ForeignKey(Jasoseol, on_delete=models.CASCADE)
      ```
    - adminì— ë“±ë¡
    - modelform ì‚¬ìš©í•˜ì—¬ htmlì— ì¶”ê°€
      - forms.py
        ```python
        class CommentForm(forms.ModelForm):

            class Meta:
                model = Comment
                fields = ('content', )

            def __init__(self, *args, **kwargs):
                super().__init__(*args, **kwargs)
                self.fields['content'].label = "ëŒ“ê¸€"
        ```
      - views.pyì— detail í•¨ìˆ˜ì—ì„œ ê°ì²´ ìƒì„±í•˜ì—¬ ì „ë‹¬
      - detail.htmlì— ì¶”ê°€ 
        ```html
        <form method="POST" action="{% url 'create_comment' my_jss.id %}">
            {% csrf_token %}
            {{commet_form}}
            <input type="submit" value="í™•ì¸">
        </form>

        {% for comment in my_jss.comment_set.all %}
        <p>
            {{comment.author}} ğŸ”Š {{comment.content}}
            {% if user == comment.author %}
                <a href="{% url 'delete_comment' my_jss.id comment.id %}">
                    <button>ì‚­ì œ</button>
                </a>
            {% endif %}
        </p>

        {% endfor %}
        ```
      - url ì¶”ê°€
        ```python
        path('create_comment/<int:jss_id>/', create_comment, name="create_comment"),
        path('delete_comment/<int:jss_id>/<int:comment_id>/', delete_comment, name="delete_comment"),
        ```
      - views.pyì— ìƒì„±
        ```python
        def create_comment(request, jss_id):
            comment_form = CommentForm(request.POST)
            if comment_form.is_valid():
                temp_form = comment_form.save(commit=False)
                temp_form.author = request.user #ì…ë ¥ë°›ì€ ê°’ ì´ì™¸ ë‹¤ë¥¸ ê°’ ì¶”ê°€
                temp_form.jasoseol = Jasoseol.objects.get(pk=jss_id)
                temp_form.save()
                return redirect('detail', jss_id)
                
        def delete_comment(request, jss_id, comment_id):
            my_comment = Comment.objects.get(pk=comment_id)
            if request.user == my_comment.author:
                my_comment.delete() #ìì‹ ì˜ ëŒ“ê¸€ë§Œ ì‚­ì œ
                return redirect('detail', jss_id)
            else:
                raise PermissionDenied
        ```

## ê¸€ììˆ˜ ì„¸ê¸°

- ìš”ì†Œ ì„ íƒ 
  - querySelector()
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  - ìš”ì†Œ.addEventListener("ì´ë²¤íŠ¸", ì´ë²¤íŠ¸ë¥¼ ê°ì§€í–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜)
  
- ì‹¤ìŠµ
  - create.htmlì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
    ```html
    <script src="{% static 'js/count.js' %}"></script>
    ```
  - static/js/count.js ìƒì„±
    ```js
    const targetForm = document.querySelector('.jss_content_form')
    const counted_text = document.querySelector('.counted_text')

    targetForm.addEventListener("keyup", function() {
        counted_text.innerHTML = targetForm.value.length
    })
    ```
  
  
  
  
  
  
  
  
  
  
  
